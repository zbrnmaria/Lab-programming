import unittest
from soundness_check import correct_uv

class TestUVSoundness(unittest.TestCase):
    
    def setUp(self):
        """Завантаження тестових текстів."""
        with open('test_texts.txt', 'r', encoding='utf-8') as f:
            self.test_texts = f.read().split('\n\n')

    def test_correction_rules(self):
        # Приклад 1: Приголосний + Приголосний -> У
        self.assertEqual(correct_uv("Прийшов в сад"), "Прийшов у сад")
        # Приклад 2: Голосний + Голосний -> В
        self.assertEqual(correct_uv("Була у місті"), "Була в місті")
        # Приклад 3: Голосний + Голосний -> В
        self.assertEqual(correct_uv("у нього в очах"), "у нього в очах") # Тут "в" коректне
        self.assertEqual(correct_uv("в очах"), "В очах") # Початок речення перед голосним
        self.assertEqual(correct_uv("і вночі"), "і вночі") # Голосний + Приголосний (не В/Ф) -> В

    def test_hard_consonants(self):
        # Приклад: перед В -> У
        self.assertEqual(correct_uv("сидимо в вагоні"), "сидимо у вагоні")
        # Приклад: префікс перед В -> У
        self.assertEqual(correct_uv("Вважай на мене"), "Уважай на мене")

    def test_full_texts(self):
        # Перевірка на текстах з файлу
        # Зверніть увагу: очікуваний результат треба визначити вручну згідно з правилами
        
        # Тестовий текст 1 (виправлення):
        # "Прийшов в сад" -> "Прийшов у сад" (пригол-пригол)
        # "Була у місті" -> "Була в місті" (голос-пригол)
        # "В очах" -> "В очах" (початок перед голосним)
        # "у вечірній" -> "у вечірній" (голос-важкий пригол)
        # "в вагоні" -> "у вагоні" (перед "в")
        expected1 = "Прийшов у сад вишневий. Була в місті тихо. В очах засяяла іскра. Зібрались у вечірній час. Ми сидимо у вагоні потяга."
        self.assertEqual(correct_uv(self.test_texts[0].split('\n', 1)[1].strip()), expected1)
        
        # Тестовий текст 2 (виправлення):
        # "У нас в школі" -> "У нас у школі" (голос-пригол)
        # "йшла у кімнату" -> "йшла в кімнату" (голос-пригол)
        # "у нього" -> "у нього" (коректно)
        expected2 = "У нас у школі є учень, що займається у спортивній секції. Вона йшла в кімнату, щоб покласти речі. Потім узяла у нього важливий документ."
        self.assertEqual(correct_uv(self.test_texts[1].split('\n', 1)[1].strip()), expected2)
        
        # Тестовий текст 3:
        # "втік у воду" -> "уттік у воду" (префікс, пригол-голос) - **Увага: утік, а не уттік**
        # Для простоти, наша модель корегує "Втік" -> "Утік" (як префікс)
        # "він втомлено" -> "він утомлено" (пригол-важкий пригол)
        expected3 = "Він утік у воду, а потім виліз. Вона побачила, як він утомлено йшов. Усе вказувало на те, що у нього проблеми."
        self.assertEqual(correct_uv(self.test_texts[2].split('\n', 1)[1].strip()), expected3)

        # Тестовий текст 4:
        # "вдача" - виняток
        # "Умова" - виняток
        expected4 = "Це вдача, а не укладений план. Стоїть на видноколі мати – у неї вчись. Умова важлива."
        self.assertEqual(correct_uv(self.test_texts[3].split('\n', 1)[1].strip()), expected4)

if __name__ == '__main__':
    unittest.main(argv=['first-arg-is-ignored'], exit=False)

# Кінець `tests.py`